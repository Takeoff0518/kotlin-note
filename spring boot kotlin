# Spring Boot with Kotlin

## Introduction

<https://spring.io>

`@RestController` 标记该类为 Web 控制器，`@RequestMapping("xxx")` 定义路由。

```kt
@RestController
@RequestMapping("api/hello") // 这个类里所有的接口地址都要先经过这个路径
class HelloWorldController {

    @GetMapping("springboot")
    fun helloWorld(): String = "Hello, this is a REST endpoint!"
}
```

此时访问 `localhost:8080/api/hello/springboot`，浏览器显示 `Hello, this is a REST endpoint!`。

## 项目结构

```kt
my-app/
├── gradle/                  # Gradle 包装器文件夹（保证团队版本统一）
├── src/                     # 源代码目录（最核心的部分）
│   ├── main/                # 主程序代码
│   │   ├── kotlin/          # Kotlin 代码（你的业务逻辑）
│   │   │   └── com/example/ # 遵循包名结构
│   │   │       ├── MyConfig.kt     # 配置类
│   │   │       ├── controller/     # 控制器层 (Web API)
│   │   │       ├── service/        # 业务逻辑层
│   │   │       └── MyApplication.kt # 启动类 (入口)
│   │   └── resources/       # 静态资源与配置
│   │       ├── static/      # 存放 HTML, CSS, JS 等静态文件
│   │       ├── templates/   # 存放 HTML 模板 (如 Thymeleaf)
│   │       └── application.properties (或 .yml) # 项目全局配置文件
│   └── test/                # 测试代码
│       └── kotlin/          # 单元测试与集成测试
├── build.gradle.kts         # Gradle 的构建脚本 (Kotlin 脚本模式)
├── settings.gradle.kts      # 项目名称与多模块配置
└── gradlew                  # Unix 系统的 Gradle 启动脚本
```

### `build.gradle.kts`

- 插件区：

```kt
plugins {
    id("org.springframework.boot") version "3.2.0"       // 核心插件：提供运行、打包功能
    id("io.spring.dependency-management") version "1.1.4" // 自动管理依赖版本（让你不用手写版本号）
    kotlin("jvm") version "1.9.20"                        // 让 Gradle 支持 Kotlin 编译
    kotlin("plugin.spring") version "1.9.20"               // 专门为 Spring 优化的 Kotlin 插件（处理 open class 等问题）
}
```

- 项目元数据：

```kt
group = "com.example"    // 组织 ID，通常是域名反写
version = "0.0.1-SNAPSHOT" // 项目版本号
java.sourceCompatibility = JavaVersion.VERSION_17 // 指定使用的 Java 版本
```

- 仓库设置：

```kt
repositories {
    mavenCentral() // 绝大多数情况下使用中央仓库
}
```

- 依赖：

Spring Boot 使用 Starters 来简化依赖

```kt
dependencies {
    // Web 开发核心：包含 Tomcat, Spring MVC, JSON 处理等
    implementation("org.springframework.boot:spring-boot-starter-web")
    
    // Kotlin 反射库：Spring 运行需要用到它
    implementation("org.jetbrains.kotlin:kotlin-reflect")
    
    // 测试模块：包含 JUnit, AssertJ 等测试工具
    testImplementation("org.springframework.boot:spring-boot-starter-test")
}
```

PS: dependency-management 会自动匹配与你 Spring Boot 版本兼容的最佳版本，不用写版本号。

- 任务配置：

可以自定义编译行为

```kt
tasks.withType<org.jetbrains.kotlin.gradle.tasks.KotlinCompile> {
    kotlinOptions {
        freeCompilerArgs += "-Xjsr305=strict" // 增强 Kotlin 对 Java 可空性的检查
        jvmTarget = "21"
    }
}

tasks.withType<Test> {
    useJUnitPlatform() // 告诉 Gradle 使用 JUnit 5 运行测试
}
```

### 入口程序

```kt
package ...

import ...

@SpringBootApplication
class MyApplication

fun main(args: Array<String>) {
    runApplicattion<MyApplication>(*args)
}
```

### 配置文件

Spring Boot 应用运行时的配置，在 `src/main/resources/` 下的 `application.properties` 或 `application.yml`。

e.g.:

修改服务器端口：

```yaml
server:
  port: 8081
  servlet:
    context-path: /api
```

配置数据库：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb
    username: root
    password: password123
```

可以创建多个文件，如 `application-dev.yml` 和 `application-prod.yml`，然后在主配置文件里切换：

```yaml
spring:
  profiles:
    active: dev  # 切换到 dev，Spring 就会加载 application-dev.yml
```

## 数据层

